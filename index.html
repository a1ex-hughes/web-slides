<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide Viewer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://unpkg.com/mammoth@1.6.0/mammoth.browser.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide React icons (inline simplified versions)
        const ChevronLeft = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"></polyline></svg>;
        const ChevronRight = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const Upload = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>;
        const FileText = (props) => <svg width={props.className?.includes('w-10') ? "40" : "24"} height={props.className?.includes('w-10') ? "40" : "24"} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>;

        function SlideViewer() {
            const [slides, setSlides] = useState([]);
            const [currentSlide, setCurrentSlide] = useState(0);
            const [loading, setLoading] = useState(false);
            const [progress, setProgress] = useState(0);
            const [loadingMessage, setLoadingMessage] = useState('');
            const [fileName, setFileName] = useState('');
            const [pdfJsLoaded, setPdfJsLoaded] = useState(false);

            const wiseSlogans = [
                "Converting pixels to possibilities...",
                "Transforming presentations, one slide at a time...",
                "Rome wasn't built in a day, but your slides will be ready soon...",
                "Good things come to those who wait (and upload files)...",
                "Brewing some digital magic for you...",
                "Teaching old slides new tricks...",
                "Making your content web-ready...",
                "Patience is a virtue, slides are almost ready...",
                "Converting with care and precision...",
                "Almost there! Your slides are getting a makeover...",
                "Quality takes time, but we're fast...",
                "Slide by slide, we're getting there...",
                "Your presentations deserve the best conversion...",
                "Processing with style and grace...",
                "The best things in life are worth the wait..."
            ];

            useEffect(() => {
                if (window.pdfjsLib) {
                    window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    setPdfJsLoaded(true);
                }
            }, []);

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setLoading(true);
                setProgress(0);
                setFileName(file.name);
                setCurrentSlide(0);
                setLoadingMessage(wiseSlogans[Math.floor(Math.random() * wiseSlogans.length)]);
                setProgress(10);

                try {
                    if (file.type === 'application/pdf') {
                        if (!pdfJsLoaded) {
                            alert('PDF library is still loading. Please try again in a moment.');
                            setLoading(false);
                            return;
                        }
                        await loadPDF(file);
                    } else if (file.type === 'application/vnd.openxmlformats-officedocument.presentationml.presentation') {
                        await loadPPTX(file);
                    } else {
                        alert('Please upload a PDF or PPTX file.');
                        setLoading(false);
                        return;
                    }
                    setProgress(100);
                } catch (err) {
                    console.error('Error loading file:', err);
                    alert('Error loading file: ' + err.message);
                    setLoading(false);
                    setProgress(0);
                    return;
                }

                setTimeout(() => {
                    setLoading(false);
                    setProgress(0);
                }, 500);
            };

            const loadPDF = async (file) => {
                const pdfjsLib = window.pdfjsLib;
                setProgress(20);
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                const slideImages = [];
                const totalPages = pdf.numPages;
                setProgress(30);

                for (let i = 1; i <= totalPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 2 });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({ canvasContext: context, viewport }).promise;
                    slideImages.push(canvas.toDataURL());
                    
                    const pageProgress = 30 + ((i / totalPages) * 65);
                    setProgress(Math.floor(pageProgress));
                    
                    if (i % 3 === 0) {
                        setLoadingMessage(wiseSlogans[Math.floor(Math.random() * wiseSlogans.length)]);
                    }
                }

                setSlides(slideImages);
                setProgress(95);
            };

            const loadPPTX = async (file) => {
                setProgress(20);
                const arrayBuffer = await file.arrayBuffer();
                setProgress(40);
                
                const result = await mammoth.convertToHtml({ arrayBuffer });
                setProgress(60);
                
                const content = result.value;
                const parser = new DOMParser();
                const doc = parser.parseFromString(content, 'text/html');
                const elements = Array.from(doc.body.children);
                setProgress(70);
                
                const slideGroups = [];
                let currentGroup = [];
                
                elements.forEach((el) => {
                    if (el.tagName.match(/H[1-6]/) || currentGroup.length >= 4) {
                        if (currentGroup.length > 0) {
                            slideGroups.push(currentGroup);
                        }
                        currentGroup = [el.outerHTML];
                    } else {
                        currentGroup.push(el.outerHTML);
                    }
                });
                
                if (currentGroup.length > 0) {
                    slideGroups.push(currentGroup);
                }

                setProgress(90);
                setSlides(slideGroups.map(group => group.join('')));
                setProgress(95);
            };

            const nextSlide = () => {
                if (currentSlide < slides.length - 1) {
                    setCurrentSlide(currentSlide + 1);
                }
            };

            const prevSlide = () => {
                if (currentSlide > 0) {
                    setCurrentSlide(currentSlide - 1);
                }
            };

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key === 'ArrowRight') nextSlide();
                    if (e.key === 'ArrowLeft') prevSlide();
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [currentSlide, slides.length]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex flex-col">
                    <div className="bg-slate-800/50 backdrop-blur-sm border-b border-slate-700/50 px-6 py-4">
                        <div className="max-w-7xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <FileText className="w-6 h-6 text-blue-400" />
                                <h1 className="text-xl font-semibold text-white">Slide Viewer</h1>
                            </div>
                            
                            <label className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg cursor-pointer transition-colors">
                                <Upload />
                                <span className="text-sm font-medium">Upload File</span>
                                <input type="file" accept=".pdf,.pptx" onChange={handleFileUpload} className="hidden" />
                            </label>
                        </div>
                    </div>

                    <div className="flex-1 flex items-center justify-center p-8">
                        {loading ? (
                            <div className="text-center max-w-lg w-full">
                                <div className="mb-8">
                                    <div className="w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                                    <h2 className="text-2xl font-semibold text-white mb-4">Converting Your Slides</h2>
                                    <p className="text-lg text-blue-300 mb-8 italic min-h-[2rem]">{loadingMessage}</p>
                                </div>
                                
                                <div className="w-full bg-slate-700 rounded-full h-4 overflow-hidden shadow-inner">
                                    <div className="h-full bg-gradient-to-r from-blue-500 via-blue-400 to-cyan-400 rounded-full transition-all duration-300 ease-out relative overflow-hidden" style={{ width: `${progress}%` }}>
                                        <div className="absolute inset-0 bg-white/20 animate-pulse"></div>
                                    </div>
                                </div>
                                <p className="text-slate-400 mt-3 text-sm">{progress}% complete</p>
                            </div>
                        ) : slides.length === 0 ? (
                            <div className="text-center max-w-md">
                                <div className="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <FileText className="w-10 h-10 text-slate-500" />
                                </div>
                                <h2 className="text-2xl font-semibold text-white mb-2">No slides loaded</h2>
                                <p className="text-slate-400 mb-6">Upload a PDF or PPTX file to get started</p>
                                {!pdfJsLoaded && <p className="text-sm text-yellow-400">Loading PDF library...</p>}
                            </div>
                        ) : (
                            <div className="w-full max-w-5xl">
                                <div className="bg-white rounded-lg shadow-2xl overflow-hidden mb-6" style={{ aspectRatio: '16/9' }}>
                                    {fileName.endsWith('.pdf') ? (
                                        <img src={slides[currentSlide]} alt={`Slide ${currentSlide + 1}`} className="w-full h-full object-contain" />
                                    ) : (
                                        <div className="w-full h-full overflow-auto p-12 prose prose-lg max-w-none" dangerouslySetInnerHTML={{ __html: slides[currentSlide] }} />
                                    )}
                                </div>

                                <div className="flex items-center justify-between">
                                    <button onClick={prevSlide} disabled={currentSlide === 0} className="flex items-center gap-2 px-6 py-3 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors">
                                        <ChevronLeft />
                                        <span className="font-medium">Previous</span>
                                    </button>

                                    <div className="flex items-center gap-4 px-6 py-3 bg-slate-800/50 rounded-lg">
                                        <span className="text-slate-300">
                                            Slide <span className="text-white font-semibold">{currentSlide + 1}</span> of <span className="text-white font-semibold">{slides.length}</span>
                                        </span>
                                    </div>

                                    <button onClick={nextSlide} disabled={currentSlide === slides.length - 1} className="flex items-center gap-2 px-6 py-3 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors">
                                        <span className="font-medium">Next</span>
                                        <ChevronRight />
                                    </button>
                                </div>

                                <div className="text-center mt-6">
                                    <p className="text-sm text-slate-500">
                                        Use <kbd className="px-2 py-1 bg-slate-800 rounded text-xs">←</kbd> and <kbd className="px-2 py-1 bg-slate-800 rounded text-xs">→</kbd> arrow keys to navigate
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>

                    {fileName && !loading && (
                        <div className="bg-slate-800/30 backdrop-blur-sm border-t border-slate-700/50 px-6 py-3">
                            <div className="max-w-7xl mx-auto">
                                <p className="text-sm text-slate-400 text-center">
                                    Currently viewing: <span className="text-white font-medium">{fileName}</span>
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<SlideViewer />, document.getElementById('root'));
    </script>
</body>
</html>